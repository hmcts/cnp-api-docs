{"openapi":"3.0.1","info":{"title":"Error Notification Service","description":"API consuming Azure ServiceBus messages and publishing error messages to the scan supplier","license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"},"version":"1"},"servers":[{"url":"http://localhost","description":"Generated server url"}],"tags":[{"name":"Information on notifications","description":"Endpoint for notifications present for this service"}],"paths":{"/notifications":{"get":{"tags":["Information on notifications"],"summary":"Get list of error notifications","description":"Get list of error notifications for specific date","operationId":"getNotifications_1_1","parameters":[{"name":"file_name","in":"query","description":"File name to look up","required":true,"schema":{"type":"string"},"example":"2000000000000_24-06-2020-12-28-19.example.zip"},{"name":"ServiceAuthorization","in":"header","required":false,"schema":{"type":"string"}},{"name":"zip_file_name","in":"query","description":"File name to look-up notifications","required":true,"schema":{"type":"string"},"example":"2022304020414_17-08-2020-11-19-12.zip"},{"name":"date","in":"query","description":"Date boundary to look-up notifications in","required":true,"schema":{"type":"string","format":"date"},"example":"2020-06-24"}],"responses":{"401":{"description":"Unauthenticated / Invalid token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationsResponse"}}}},"200":{"description":"Success","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationsResponse"}}}},"500":{"description":"Error getting data","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationsResponse"}}}}}},"post":{"tags":["Information on notifications"],"summary":"Add a new notification","operationId":"addNotification","parameters":[{"name":"ServiceAuthorization","in":"header","required":false,"schema":{"type":"string"}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotifyRequest"}}},"required":true},"responses":{"424":{"description":"If there is an error notifying the supplier","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationInfo"}}}},"400":{"description":"If the notify request body does not pass validation","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationInfo"}}}},"401":{"description":"Unauthorised user/Invalid token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationInfo"}}}},"201":{"description":"Successfully created notification","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationInfo"}}}}}}},"/notifications/{notificationId}":{"get":{"tags":["Information on notifications"],"summary":"Get a Notification by its ID","operationId":"getNotificationByNotificationId","parameters":[{"name":"notificationId","in":"path","required":true,"schema":{"type":"integer","format":"int32"}}],"responses":{"400":{"description":"Given ID is malformed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationInfo"}}}},"404":{"description":"Notification Not Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationInfo"}}}},"200":{"description":"Successful - Notification Found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationInfo"}}}}}}},"/notifications/all-pending":{"get":{"tags":["Information on notifications"],"summary":"Get list of error notifications","description":"Get list of all pending notifications","operationId":"getAllPendingNotifications","responses":{"401":{"description":"Unauthenticated / Invalid token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationsResponse"}}}},"200":{"description":"Success","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationsResponse"}}}},"500":{"description":"Error validating service header","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationsResponse"}}}}}}},"/feature-flags/{flag}":{"get":{"tags":["feature-flag-controller"],"operationId":"flagStatus","parameters":[{"name":"flag","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"string"}}}}}}}},"components":{"schemas":{"NotifyRequest":{"required":["container","error_code","error_description","service","zip_file_name"],"type":"object","properties":{"zip_file_name":{"type":"string"},"jurisdiction":{"type":"string"},"po_box":{"type":"string"},"container":{"type":"string"},"document_control_number":{"type":"string"},"error_code":{"type":"string","enum":["ERR_FILE_LIMIT_EXCEEDED","ERR_METAFILE_INVALID","ERR_PAYMENTS_DISABLED","ERR_SERVICE_DISABLED","ERR_AV_FAILED","ERR_SIG_VERIFY_FAILED","ERR_RESCAN_REQUIRED","ERR_ZIP_PROCESSING_FAILED"]},"error_description":{"type":"string"},"service":{"type":"string"}}},"NotificationInfo":{"title":"List of notifications","type":"object","properties":{"id":{"title":"Notification internal ID","type":"string","description":"Autogenerated DB ID"},"confirmation_id":{"title":"Notification external ID","type":"string","description":"ID received from third party"},"zip_file_name":{"title":"Zip file name","type":"string"},"po_box":{"title":"PO box","type":"string"},"container":{"title":"Origin of zip_file_name","type":"string","description":"Container origin of zip_file_name"},"service":{"title":"File name representing service","type":"string"},"document_control_number":{"title":"Related DCN number","type":"string","description":"Related DNC number (if applicable)"},"error_code":{"title":"Error code","type":"string","description":"Agreed error code"},"error_description":{"title":"Error description","type":"string","description":"Error description"},"created_at":{"title":"Created at","type":"string","description":"Time when notification was created","format":"date-time"},"processed_at":{"title":"Processed at","type":"string","description":"Time when notification was persisted to third party","format":"date-time"},"status":{"title":"End state","type":"string","description":"Current end state of the notification"}},"description":"Full list of notifications found"},"NotificationsResponse":{"type":"object","properties":{"count":{"title":"Notification count","type":"integer","description":"Number of notifications found","format":"int32"},"pendingNotificationsCount":{"title":"Pending Notifications count","type":"integer","description":"Number of notifications with 'Pending' status","format":"int32"},"sentNotificationsCount":{"title":"Sent Notification count","type":"integer","description":"Number of notifications with 'Sent' status","format":"int32"},"notifications":{"title":"List of notifications","type":"array","description":"Full list of notifications found","items":{"$ref":"#/components/schemas/NotificationInfo"}}}}}}}
